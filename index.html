<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <title>Timewise GPX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/assets/timewisegpx_favicon.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: '#2563eb',
            surface: {
              light: '#f8fafc',
              dark: '#0f172a'
            }
          },
          boxShadow: {
            card: '0 10px 30px rgba(15,23,42,0.08)'
          }
        }
      }
    }
  </script>

  <!-- Leaflet (live map only; map is not printed) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <link rel="stylesheet" href="style.css" />

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JLGQF8E4P8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JLGQF8E4P8');
</script>

</head>
<body class="bg-surface-light text-slate-900 transition-colors duration-300 dark:bg-surface-dark dark:text-slate-100">
  <div class="top-bar fixed inset-x-0 bottom-0 bg-slate-900/90 text-slate-200 backdrop-blur-lg shadow-lg z-50">
    <div class="mx-auto flex w-full max-w-6xl items-center justify-end gap-3 px-4 py-2 text-sm">
      <span class="hidden sm:inline" data-i18n="top.author">Made with ‚òïÔ∏è by Charlie Centa</span>
      <span id="separator" class="hidden sm:inline">|</span>
      <div class="flex items-center gap-2">
        <a aria-label="Instagram" class="flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white transition hover:bg-white/20" href="https://www.instagram.com/charliecenta/" target="_blank"><div class="social-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M320.3 205C256.8 204.8 205.2 256.2 205 319.7C204.8 383.2 256.2 434.8 319.7 435C383.2 435.2 434.8 383.8 435 320.3C435.2 256.8 383.8 205.2 320.3 205zM319.7 245.4C360.9 245.2 394.4 278.5 394.6 319.7C394.8 360.9 361.5 394.4 320.3 394.6C279.1 394.8 245.6 361.5 245.4 320.3C245.2 279.1 278.5 245.6 319.7 245.4zM413.1 200.3C413.1 185.5 425.1 173.5 439.9 173.5C454.7 173.5 466.7 185.5 466.7 200.3C466.7 215.1 454.7 227.1 439.9 227.1C425.1 227.1 413.1 215.1 413.1 200.3zM542.8 227.5C541.1 191.6 532.9 159.8 506.6 133.6C480.4 107.4 448.6 99.2 412.7 97.4C375.7 95.3 264.8 95.3 227.8 97.4C192 99.1 160.2 107.3 133.9 133.5C107.6 159.7 99.5 191.5 97.7 227.4C95.6 264.4 95.6 375.3 97.7 412.3C99.4 448.2 107.6 480 133.9 506.2C160.2 532.4 191.9 540.6 227.8 542.4C264.8 544.5 375.7 544.5 412.7 542.4C448.6 540.7 480.4 532.5 506.6 506.2C532.8 480 541 448.2 542.8 412.3C544.9 375.3 544.9 264.5 542.8 227.5zM495 452C487.2 471.6 472.1 486.7 452.4 494.6C422.9 506.3 352.9 503.6 320.3 503.6C287.7 503.6 217.6 506.2 188.2 494.6C168.6 486.8 153.5 471.7 145.6 452C133.9 422.5 136.6 352.5 136.6 319.9C136.6 287.3 134 217.2 145.6 187.8C153.4 168.2 168.5 153.1 188.2 145.2C217.7 133.5 287.7 136.2 320.3 136.2C352.9 136.2 423 133.6 452.4 145.2C472 153 487.1 168.1 495 187.8C506.7 217.3 504 287.3 504 319.9C504 352.5 506.7 422.6 495 452z"/></svg></div></a>
        <a aria-label="YouTube" class="flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white transition hover:bg-white/20" href="https://www.youtube.com/charliecenta/" target="_blank"><div class="social-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M378 320.2L282.8 266.1L282.8 374.3L378 320.2zM480 96L160 96C124.7 96 96 124.7 96 160L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 160C544 124.7 515.3 96 480 96zM494.4 232.1C502 260.7 502 320.3 502 320.3C502 320.3 502 379.9 494.4 408.4C490.2 424.2 477.9 436.1 462.2 440.3C433.9 448 320 448 320 448C320 448 206.1 448 177.8 440.4C162.1 436.2 149.8 424.3 145.6 408.5C138 379.9 138 320.3 138 320.3C138 320.3 138 260.6 145.6 232.1C149.8 216.3 162.1 203.9 177.8 199.7C206.1 192 320 192 320 192C320 192 433.9 192 462.2 199.7C477.9 203.9 490.2 216.3 494.4 232.1z"/></svg></div></a>
        <a aria-label="Tik Tok" class="flex h-8 w-8 items-center justify-center rounded-full bg-white/10 text-white transition hover:bg-white/20" href="https://www.tiktok.com/@charliecentaclimbs" target="_blank"><div class="social-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M544.5 273.9C500.5 274 457.5 260.3 421.7 234.7L421.7 413.4C421.7 446.5 411.6 478.8 392.7 506C373.8 533.2 347.1 554 316.1 565.6C285.1 577.2 251.3 579.1 219.2 570.9C187.1 562.7 158.3 545 136.5 520.1C114.7 495.2 101.2 464.1 97.5 431.2C93.8 398.3 100.4 365.1 116.1 336C131.8 306.9 156.1 283.3 185.7 268.3C215.3 253.3 248.6 247.8 281.4 252.3L281.4 342.2C266.4 337.5 250.3 337.6 235.4 342.6C220.5 347.6 207.5 357.2 198.4 369.9C189.3 382.6 184.4 398 184.5 413.8C184.6 429.6 189.7 444.8 199 457.5C208.3 470.2 221.4 479.6 236.4 484.4C251.4 489.2 267.5 489.2 282.4 484.3C297.3 479.4 310.4 469.9 319.6 457.2C328.8 444.5 333.8 429.1 333.8 413.4L333.8 64L421.8 64C421.7 71.4 422.4 78.9 423.7 86.2C426.8 102.5 433.1 118.1 442.4 131.9C451.7 145.7 463.7 157.5 477.6 166.5C497.5 179.6 520.8 186.6 544.6 186.6L544.6 274z"/></svg></div></a>
      </div>
    </div>
  </div>

  <div class="mx-auto flex min-h-screen max-w-6xl flex-col px-4 pb-28 pt-10">
    <header class="flex flex-col gap-4 rounded-2xl bg-white/60 p-4 backdrop-blur dark:bg-slate-900/60 sm:flex-row sm:items-center sm:justify-between">
      <a class="flex items-center gap-3 text-slate-900 no-underline dark:text-white" href="./" aria-label="Timewise GPX">
        <img src="assets/timewisegpx_logo.svg" alt="Timewise GPX" id="appLogo" class="h-10 w-auto drop-shadow-sm" />
        <span class="text-lg font-semibold tracking-tight">Timewise GPX</span>
      </a>

      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2">
          <label for="languageSelector" class="visually-hidden" data-i18n="labels.languageSelect">Language</label>
          <select id="languageSelector" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" data-i18n-attrs="aria-label:labels.languageSelect"></select>
        </div>
        <button id="themeToggle" class="flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 bg-white text-lg shadow-sm transition hover:-translate-y-0.5 hover:shadow-md focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800" data-i18n-attrs="title:buttons.themeToggle" title="Toggle theme">üåó</button>
        <button id="savePlanBtn" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" data-i18n="buttons.save" disabled>Save</button>
        <button id="loadPlanBtn" class="rounded-xl border border-slate-200 bg-brand px-4 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-brand" data-i18n="buttons.load">Load</button>
      </div>
    </header>

    <main class="mt-8 flex flex-col gap-6">
      <section class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        <div class="card h-full rounded-2xl border border-slate-200 bg-white p-6 shadow-card dark:border-slate-800 dark:bg-slate-900">
          <div class="flex items-start justify-between gap-4">
            <div>
              <p class="text-xs uppercase tracking-[0.2em] text-brand/70" data-i18n="gpx.title">GPX Upload</p>
              <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-50">Upload your track</h2>
            </div>
          </div>

          <label class="mt-4 block">
            <div id="gpxDrop" class="dropzone group flex cursor-pointer flex-col items-center justify-center gap-3 rounded-2xl border-2 border-dashed border-brand/50 bg-white px-6 py-8 text-center text-slate-700 shadow-inner transition dark:bg-slate-900">
              <svg aria-hidden="true" width="56" height="56" viewBox="0 0 24 24" class="text-brand"><path fill="currentColor" d="M12 2l4 4h-3v6h-2V6H8l4-4zM6 14h12a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2a2 2 0 012-2z"/></svg>
              <div class="space-y-1">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-50" data-i18n="gpx.dropzoneHeading">Upload GPX file</h3>
                <p class="text-sm text-slate-500" data-i18n="gpx.dropHint">Drag & drop a GPX file here, or</p>
              </div>
              <button id="selectGpxBtn" type="button" class="rounded-full bg-brand px-5 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl" data-i18n="buttons.selectFile">Select File</button>
              <input id="gpxFile" type="file" accept=".gpx,.GPX,application/gpx+xml,application/xml,text/xml,application/octet-stream" hidden>
              <div id="gpxStatus" class="dz-status text-sm text-slate-500" aria-live="polite"></div>
            </div>
          </label>
        </div>

        <div class="card rounded-2xl border border-slate-200 bg-white p-6 shadow-card dark:border-slate-800 dark:bg-slate-900" id="settingsCard">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-[0.2em] text-brand/70" data-i18n="settings.title">Settings</p>
              <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-50">Configure your plan</h2>
            </div>
          </div>
          <div class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-2" id="controls">
            <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span data-i18n="settings.activity.label">Activity</span>
              <select id="activityType" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100">
                <option value="hike" selected data-i18n="settings.activity.hike">Hiking / trail</option>
                <option value="snowshoe" data-i18n="settings.activity.snowshoe">Snowshoeing</option>
              </select>
            </label>

            <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span data-i18n="settings.flatSpeed">Flat speed (km/h)</span>
              <input type="number" id="speedFlat" step="0.1" value="4" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span data-i18n="settings.verticalSpeed">Vertical speed (m/h)</span>
              <input type="number" id="speedVert" step="10" value="300" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <label class="flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200 break">
              <span class="flex items-center justify-between gap-2">
                <span data-i18n="settings.downhillFactor">Downhill factor</span>
                <button type="button" class="help-tip" aria-label="Downhill factor info"
                  data-i18n-attrs="data-tip:settings.downhillTip"
                  data-tip="Multiplicative factor for downhill segments. 0.66 means downhill takes two-thirds the time of flat/uphill for the same segment. Higher than 1.0 makes downhill slower (technical terrain).">i</button>
              </span>
              <input type="number" id="downhillFactor" step="0.01" value="0.6667" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <label class="advanced flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span class="flex items-center justify-between gap-2">
                <span data-i18n="settings.resample">Resample (m)</span>
                <button type="button" class="help-tip" aria-label="Resample info"
                  data-i18n-attrs="data-tip:settings.resampleTip"
                  data-tip="Create evenly spaced points along the track. Smaller values (e.g., 1‚Äì3 m) capture curves better but use more points. Larger values run faster with less detail.">i</button>
              </span>
              <input type="number" id="spacingM" step="1" value="3" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <label class="advanced flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span class="flex items-center justify-between gap-2">
                <span data-i18n="settings.smooth">Smooth window (m)</span>
                <button type="button" class="help-tip" aria-label="Smooth window info"
                  data-i18n-attrs="data-tip:settings.smoothTip"
                  data-tip="Median filter size in metres used to remove elevation spikes. Small windows keep detail; larger windows are smoother but can flatten short features.">i</button>
              </span>
              <input type="number" id="smoothWinM" step="1" value="15" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <label class="advanced flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200">
              <span class="flex items-center justify-between gap-2">
                <span data-i18n="settings.deadband">Elevation deadband (m)</span>
                <button type="button" class="help-tip" aria-label="Deadband info"
                  data-i18n-attrs="data-tip:settings.deadbandTip"
                  data-tip="Ignore elevation wiggles smaller than this threshold when computing ascent/descent (reduces GPS jitter). Typical: 1‚Äì3 m.">i</button>
              </span>
              <input type="number" id="elevDeadbandM" step="1" value="2" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-800 shadow-sm transition focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" />
            </label>

            <div class="col-span-1 md:col-span-2 flex flex-col gap-3 text-sm text-slate-700 dark:text-slate-200">
              <label class="flex items-center gap-2 text-sm font-medium">
                <input type="checkbox" id="showAdvanced" class="h-4 w-4 rounded border-slate-300 text-brand focus:ring-brand" />
                <span data-i18n="settings.showAdvanced">Show advanced configuration</span>
              </label>
              <label class="flex items-center gap-2 text-sm font-medium">
                <input type="checkbox" id="importRoadbooks" checked class="h-4 w-4 rounded border-slate-300 text-brand focus:ring-brand" />
                <span data-i18n="settings.importRoadbooks">Import roadbooks from GPX</span>
              </label>
            </div>
          </div>
          <div class="mt-6 flex flex-wrap items-center justify-between gap-4">
            <div class="flex items-center gap-2 text-xs uppercase tracking-[0.15em] text-slate-400">Planner controls</div>
            <button id="updateSettingsBtn" class="rounded-xl bg-brand px-5 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-brand" data-i18n="buttons.updateSettings">Update settings</button>
          </div>
          <input type="file" id="loadPlanInput" accept=".json" hidden />
        </div>
      </section>

      <section class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        <div class="card is-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-card dark:border-slate-800 dark:bg-slate-900" id="mapCard">
          <div class="mb-4 flex items-center justify-between gap-4">
            <div>
              <p class="text-xs uppercase tracking-[0.2em] text-brand/70" data-i18n="map.title">Map</p>
              <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-50">Route preview</h2>
            </div>
            <button id="clearRoadbooksBtn" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" data-i18n="buttons.clearRoadbooks" disabled>Clear roadbooks</button>
          </div>
          <div id="map" class="map h-[420px] w-full rounded-xl border border-slate-200 bg-slate-100 shadow-inner dark:border-slate-800 dark:bg-slate-800" role="img" aria-label="Route map"></div>
        </div>

        <div class="card is-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-card dark:border-slate-800 dark:bg-slate-900" id="summaryCard">
          <p class="text-xs uppercase tracking-[0.2em] text-brand/70" data-i18n="map.summary">Summary</p>
          <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-50">Route breakdown</h2>
          <div id="output" class="mt-4 space-y-2 text-sm text-slate-700 dark:text-slate-200"></div>
        </div>
      </section>

      <section class="card is-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-card dark:border-slate-800 dark:bg-slate-900" id="roadbooksCard">
        <div class="mb-4 flex flex-wrap items-center justify-between gap-4">
          <div>
            <p class="text-xs uppercase tracking-[0.2em] text-brand/70" data-i18n="map.itinerary">Itinerary</p>
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-50">Roadbooks</h2>
          </div>
          <div class="flex flex-wrap items-center gap-3">
            <button id="printBtn" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg focus:border-brand focus:outline-none focus:ring-2 focus:ring-brand disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100" data-i18n="buttons.print" disabled>Print</button>
            <button id="exportCsvBtn" class="rounded-xl bg-brand px-4 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-brand disabled:cursor-not-allowed disabled:opacity-60" data-i18n="buttons.exportCsv" disabled>Export CSV</button>
          </div>
        </div>
        <div class="table-outer">
          <div class="table-wrap" id="roadbooksTableWrap">
            <div id="roadbooks"><!-- JS inserts the table here --></div>
          </div>
          <div class="table-fade table-fade-right" aria-hidden="true"></div>
          <div class="table-fade table-fade-left"  aria-hidden="true"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script type="module" src="js/main.js"></script>
</body>
</html>
